import Image from 'next/image';
import Head from 'next/head';
import styles from '../styles/Home.module.css';
import { useState } from 'react';
import React from 'react';
import ReactPlayer from "react-player";
export default function Home() {
    const [isPlaying, setIsPlaying] = useState(false);
    const tabTitleList = ["youtube","soundcloud","mp3"];
    const [currentTab, setCurrentTab] = useState("youtube");
    const [playlist, setPlaylist] = useState([
        {
            id:1,name: "My, nah, your playlist",
            src: "https://www.youtube.com/playlist?list=PLktFEPieLGU-UKQYl2huD770l-yzftC0n",
        },
        { id:2,name: "7UPPERCUTS x Đá Số Tới / Tuyển tập Pop Punks", src: "https://youtu.be/22nk6yEPlfA" },
        { id:3,name: "Lukas Graham - Happy Home", src: "https://youtu.be/QX6UhufF0cs" },
    ]);
    const [nowPlaying, setNowPlaying] = useState(playlist[0]);

    // functions
    const onNowPlayingEnded = () => {
        const nowPlayingIndex = playlist.findIndex(p => p.name === nowPlaying.name)
        setNowPlaying(playlist[nowPlayingIndex+1]);
    }
    const onPortalClick = (action) => {
        const nowPlayingIndex = playlist.findIndex(p => p.id === nowPlaying.id);
        if(action === "next") {
            nowPlayingIndex === playlist.length - 1 ? 
            setNowPlaying(playlist[0]) : 
            setNowPlaying(playlist[nowPlayingIndex + 1]);
        }
        else{
            nowPlayingIndex === 0 ?
            setNowPlaying(playlist[playlist.length - 1]) : 
            setNowPlaying(playlist[nowPlayingIndex - 1]);
        }
    }
    const onTabClick = (tab) => {
        if(tab !== currentTab){
            setCurrentTab(tab);
        }
        return;
    }
    const playSelectedSong = (id) => { 
        if(id !== nowPlaying.id)
        {
            const selectedSong = playlist.find(p=>p.id === id)
            setIsPlaying(true);
            setNowPlaying(selectedSong)
        }
        return;
    }

    return (
        <div className={styles.container}>
            <Head>
                <title>Listening to some songs</title>
                <meta name="description" content="Generated by create next app" />
                <link rel="icon" href="/song.ico" />
            </Head>
            <main className={styles.main}>
                <div className={styles.wrapper}>
                    <div className={styles.tabs}>
                        {tabTitleList.map(tab => (
                            <div
                                key={tab}
                                className={`${styles.tab} ${tab === currentTab && styles.currentTab}`}
                                onClick={() => onTabClick(tab)}
                            >
                                <span>{tab}</span>
                            </div>
                        ))}
                    </div>
                    <div className={styles.marqueeContainer}>
                        <button className={styles.portal} onClick={() => onPortalClick("back")} />
                        <div className={styles.blur} />
                        <span className={`${isPlaying && styles.marquee} ${styles.marqueeText}`}>
                            {nowPlaying.name}
                        </span>
                        <button className={styles.portal} onClick={() => onPortalClick("next")} />
                    </div>
                    <ReactPlayer
                        className={styles.controllers}
                        playing={isPlaying}
                        controls={true}
                        url={nowPlaying.src}
                        width="100%"
                        onEnded={onNowPlayingEnded}
                        onPause={() => setIsPlaying(false)}
                        onStart={() => setIsPlaying(true)}
                        onPlay={() => setIsPlaying(true)}
                    />
                    <div className={styles.playlist}>
                        <h1>PLAYLIST</h1>
                        <div className={styles.blur}></div>
                        <div className={styles.playlistitems}>
                            <ol>
                                {playlist.map(song => (
                                    <div className={styles.song} key={`container ${song.name}`}>
                                        <Image alt =" "key={song.name} onClick={() => playSelectedSong(song.id)} className={styles.songIcon} src={`${(song.id === nowPlaying.id && isPlaying)? "/playingsound.gif":"/sound.png"}`} height={40} width={40}/>
                                        <li
                                            className={`${song.id === nowPlaying.id ? styles.nowPlaying : ""} ${styles.songListItem}`}
                                            key={song.id}
                                        >
                                            <p className={`${styles.songName}`}>{song.name}</p>
                                        </li>
                                    </div>
                                ))}
                            </ol>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    );
    }
